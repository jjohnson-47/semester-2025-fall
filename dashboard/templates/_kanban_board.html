<!-- Kanban Board View -->
<div class="grid grid-cols-4 gap-4">
    <!-- Blocked Column -->
    <div class="kanban-column">
        <h3 class="font-semibold text-gray-700 mb-3 flex items-center justify-between">
            <span>ðŸ”’ Blocked</span>
            <span class="text-sm text-gray-500">{{ kanban.blocked|length }}</span>
        </h3>
        <div class="space-y-2"
             id="kanban-blocked"
             hx-post="/api/tasks/move"
             hx-trigger="drop"
             hx-vals='{"status": "blocked"}'>
            {% for task in kanban.blocked %}
                {% include '_kanban_card.html' %}
            {% endfor %}
        </div>
    </div>

    <!-- To Do Column -->
    <div class="kanban-column">
        <h3 class="font-semibold text-gray-700 mb-3 flex items-center justify-between">
            <span>ðŸ“‹ To Do</span>
            <span class="text-sm text-gray-500">{{ kanban.todo|length }}</span>
        </h3>
        <div class="space-y-2"
             id="kanban-todo"
             hx-post="/api/tasks/move"
             hx-trigger="drop"
             hx-vals='{"status": "todo"}'>
            {% for task in kanban.todo %}
                {% include '_kanban_card.html' %}
            {% endfor %}
        </div>
    </div>

    <!-- In Progress Column -->
    <div class="kanban-column">
        <h3 class="font-semibold text-gray-700 mb-3 flex items-center justify-between">
            <span>ðŸš€ In Progress</span>
            <span class="text-sm text-gray-500">{{ kanban.in_progress|length }}</span>
        </h3>
        <div class="space-y-2"
             id="kanban-in-progress"
             hx-post="/api/tasks/move"
             hx-trigger="drop"
             hx-vals='{"status": "in_progress"}'>
            {% for task in kanban.in_progress %}
                {% include '_kanban_card.html' %}
            {% endfor %}
        </div>
    </div>

    <!-- Done Column -->
    <div class="kanban-column">
        <h3 class="font-semibold text-gray-700 mb-3 flex items-center justify-between">
            <span>âœ… Done</span>
            <span class="text-sm text-gray-500">{{ kanban.done|length }}</span>
        </h3>
        <div class="space-y-2"
             id="kanban-done"
             hx-post="/api/tasks/move"
             hx-trigger="drop"
             hx-vals='{"status": "done"}'>
            {% for task in kanban.done %}
                {% include '_kanban_card.html' %}
            {% endfor %}
        </div>
    </div>
</div>

<script>
// Enable drag and drop for Kanban cards
document.addEventListener('DOMContentLoaded', function() {
    // Make cards draggable
    document.querySelectorAll('.kanban-card').forEach(card => {
        card.draggable = true;

        card.addEventListener('dragstart', (e) => {
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.innerHTML);
            e.dataTransfer.setData('task-id', e.target.dataset.taskId);
            e.target.classList.add('opacity-50');
        });

        card.addEventListener('dragend', (e) => {
            e.target.classList.remove('opacity-50');
        });
    });

    // Make columns droppable
    document.querySelectorAll('.kanban-column > div').forEach(column => {
        column.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            column.classList.add('bg-blue-50');
        });

        column.addEventListener('dragleave', (e) => {
            column.classList.remove('bg-blue-50');
        });

        column.addEventListener('drop', (e) => {
            e.preventDefault();
            column.classList.remove('bg-blue-50');

            const taskId = e.dataTransfer.getData('task-id');
            const newStatus = column.id.replace('kanban-', '').replace('-', '_');

            // Use HTMX to update the task status
            htmx.ajax('POST', `/api/tasks/${taskId}/status`, {
                values: { status: newStatus },
                target: '#task-container',
                swap: 'innerHTML'
            });
        });
    });
});
</script>
